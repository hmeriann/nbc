name: Test matrix from json
on: 
    push:
    workflow_dispatch:
jobs:
    create-json-file:
        runs-on: ubuntu-latest
        outputs:
            file: ${{ steps.file.outputs.file }}
        steps:
            - id: file
              run: |
                echo "old_tests = \[" > j.json
                echo "\{" >> j.json
                echo '  "new_name": "main",' >> j.json
                echo '  "new_sha": "latest main SHA",'  >> j.json
                echo '  "old_name": "main",' >> j.json
                echo '  "old_sha": "a week ago main SHA"' >> j.json
                echo '\},' >> j.json
                echo '\{' >> j.json
                echo '  "new_name": "main",' >> j.json
                echo '  "new_sha": "latest main SHA",' >> j.json
                echo '  "old_name": "v1.2-histrionicus",' >> j.json
                echo '  "old_sha": "latest v1.2-histrionicus SHA"' >> j.json
                echo '\}' >> j.json
                echo '\]' >> j.json

                matrix=$(cat j.json | jq -c '.')
                echo "file=$matrix" >> $GITHUB_OUTPUT
                cat j.json
    use-matrix:
        runs-on: ubuntu-latest
        needs: create-json-file
        strategy:
            matrix:
                file: ${{ needs.create-json-file.outputs.file.old_tests }}
        steps:
            - run: |
                for item in ${{matrix.file}}; do
                    echo $item
                done

        
